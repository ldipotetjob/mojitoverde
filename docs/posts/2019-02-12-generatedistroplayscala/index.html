<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/mojitoverde/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/mojitoverde/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/mojitoverde/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/mojitoverde/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Generating scala application distribution in akka &amp; play for different environments | Green Mojito in technology</title>
  <link rel = 'canonical' href = 'https://ldipotetjob.github.io/mojitoverde/posts/2019-02-12-generatedistroplayscala/'>
  <meta name="description" content="Green Mojito is a fresh site where the knowledge must be fresh but not simple, where the content can be complex but nice. This is a site where you can find different scenarios and use cases related with different technologies. We believe in the beginnings but we won&#39;t deal with &#39;hello world&#39; projects.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Generating scala application distribution in akka &amp; play for different environments" />
<meta property="og:description" content="From my perspective, Sbt is quite complex. I need to work with the sbt documentation at hand. Many people think that SBT is confusing, complicated, and opaque. My goal today: **how to generate distribution packages for different environments ** just in one command line clean &#43; compile &#43; build distribution &#43; specific environment.
What do we need:  Pass parameters to our process indicating what environment you want to build. Create a plugin to read the parameters." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ldipotetjob.github.io/mojitoverde/posts/2019-02-12-generatedistroplayscala/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-02-12T09:00:00+00:00" />
<meta property="article:modified_time" content="2019-02-12T09:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Generating scala application distribution in akka &amp; play for different environments"/>
<meta name="twitter:description" content="From my perspective, Sbt is quite complex. I need to work with the sbt documentation at hand. Many people think that SBT is confusing, complicated, and opaque. My goal today: **how to generate distribution packages for different environments ** just in one command line clean &#43; compile &#43; build distribution &#43; specific environment.
What do we need:  Pass parameters to our process indicating what environment you want to build. Create a plugin to read the parameters."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://ldipotetjob.github.io/mojitoverde/css/styles.685a7e873a497dbcea0bfa576da7a90a6fdfa467b15d351ce89f3174ed69210334f9b2965fe482172b4c8af3ce8aa5c4fbc6a257f86ab893f5a3ed0191338446.css" integrity="sha512-aFp&#43;hzpJfbzqC/pXbaepCm/fpGexXTUc6J8xdO1pIQM0&#43;bKWX&#43;SCFytMivPOiqXE&#43;8aiV/hquJP1o&#43;0BkTOERg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://ldipotetjob.github.io/mojitoverde/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/mojitoverde/">Home</a></li>
         
        <li><a href="/mojitoverde/posts">Blog</a></li>
         
        <li><a href="/mojitoverde/tags">Tags</a></li>
         
        <li><a href="/mojitoverde/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://ldipotetjob.github.io/mojitoverde/posts/2018-11-28-k8sfromscratch/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://ldipotetjob.github.io/mojitoverde/posts/2019-03-10-akkaconcurrencysolution/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&text=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&is_video=false&description=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments&body=Check out this article: https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&name=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments&description=From%20my%20perspective%2c%20Sbt%20is%20quite%20complex.%20I%20need%20to%20work%20with%20the%20sbt%20documentation%20at%20hand.%20Many%20people%20think%20that%20SBT%20is%20confusing%2c%20complicated%2c%20and%20opaque.%20My%20goal%20today%3a%20%2a%2ahow%20to%20generate%20distribution%20packages%20for%20different%20environments%20%2a%2a%20just%20in%20one%20command%20line%20clean%20%2b%20compile%20%2b%20build%20distribution%20%2b%20specific%20environment.%0aWhat%20do%20we%20need%3a%20%20Pass%20parameters%20to%20our%20process%20indicating%20what%20environment%20you%20want%20to%20build.%20Create%20a%20plugin%20to%20read%20the%20parameters." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&t=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-do-we-need">What do we need:</a></li>
        <li><a href="#buildenvplugin-code-10">buildenvplugin code 1.0</a></li>
        <li><a href="#build-code-11">build code 1.1</a></li>
        <li><a href="#commandscalaplay-code-12">commandscalaplay code 1.2</a></li>
        <li><a href="#comonsettings-code-13">comonsettings code 1.3</a></li>
        <li><a href="#buildenvplugin-code-14">buildenvplugin code 1.4</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Generating scala application distribution in akka &amp; play for different environments
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2019-02-12 09:00:00 &#43;0000 UTC" itemprop="datePublished">2019-02-12</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          8 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/mojitoverde/categories/software-distribution">software distribution</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/mojitoverde/tags/scala" rel="tag">scala</a>
            
        </div>
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <p><img src="/mojitoverde/images/sbt-copy.jpeg#floatleft" alt="sbt-copy_img">
From my perspective, Sbt is quite complex. I need to work with the <a href="https://www.scala-sbt.org/1.x/docs/index.html">sbt documentation</a> at hand. Many <a href="https://www.lihaoyi.com/post/SowhatswrongwithSBT.html">people think that SBT is confusing, complicated, and opaque</a>.
My goal today: **how to generate distribution packages for different environments ** just in one command line clean + compile + build distribution + specific environment.</p>
<h3 id="what-do-we-need">What do we need:</h3>
<ol>
<li>Pass parameters to our process indicating what environment you want to build.</li>
<li>Create a plugin to read the parameters.</li>
<li>Create a task that will let you add the project to the appropriate configuration files before the compilation process.</li>
<li>Create a command to package a distribution with the suitable option.</li>
</ol>
<p>To achieve the previous tasks, we will use <a href="https://www.scala-sbt.org/sbt-native-packager/">sbt native packager</a> to generate distribution for different environments.</p>
<p>How to approach the point 1 in <a href="#what-do-we-need">What do we need</a>:</p>
<p>The first thing that we need to do is to pass a variable in our building process:</p>
<p><strong>sbt -Dour_system_property_var=value_to_assign</strong></p>
<p>I need to indicate the environment that we are building for:
I must read this environment, set the proper configuration file, and add it to our jar distributions.</p>
<p>You ought to code what to do, considering the input parameters. You can take some reference about <a href="https://sbt-native-packager.readthedocs.io/en/latest/recipes/package_configuration.html#sbt-parameters-and-build-environment">SBT parameters and Build Environment</a>.</p>
<p>Our next steps :</p>
<ol>
<li>Read variables to indicate what environment for the new package distribution.</li>
<li>we need to indicate what config files we want to use in our compilation process, considering the input parameters.</li>
</ol>
<p>We need to create an sbt plugin(<a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/BuildEnvPlugin.scala">BuildEnvPlugin.scala</a>) to carry out the previous process:</p>
<h3 id="buildenvplugin-code-10">buildenvplugin code 1.0</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> sbt.Keys._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">import</span> sbt._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">import</span> sbt.plugins.JvmPlugin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#6272a4">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#6272a4"> * make calls in this way to generate development distro
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#6272a4"> * sbt -Denv=dev reload clean compile stage
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#6272a4"> *
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4"> * make calls in this way to generate production distro
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#6272a4"> * sbt -Denv=prod reload clean compile stage
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#6272a4"> *
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4"> */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4">/** sets the build environment */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BuildEnvPlugin</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">AutoPlugin</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span> <span style="color:#6272a4">// make sure it triggers automatically
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#6272a4"></span> <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> trigger <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">AllRequirements</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span> <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> <span style="color:#ff79c6">requires</span> <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">JvmPlugin</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span> <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">autoImport</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BuildEnv</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Enumeration</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>   <span style="color:#ff79c6">val</span> <span style="color:#50fa7b">Production</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">Test</span><span style="color:#ff79c6">,</span> <span style="color:#50fa7b">Development</span> <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Value</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  <span style="color:#ff79c6">val</span> buildEnv <span style="color:#ff79c6">=</span> settingKey<span style="color:#ff79c6">[</span><span style="color:#8be9fd">BuildEnv.Value</span><span style="color:#ff79c6">](</span><span style="color:#f1fa8c">&#34;the current build environment&#34;</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span> <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span> <span style="color:#ff79c6">import</span> autoImport._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span> <span style="color:#ff79c6">override</span> <span style="color:#ff79c6">def</span> projectSettings<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Seq</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Setting</span><span style="color:#ff79c6">[</span><span style="color:#ff79c6">_</span><span style="color:#ff79c6">]]</span> <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  buildEnv <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>   sys<span style="color:#ff79c6">.</span>props<span style="color:#ff79c6">.</span>get<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;env&#34;</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    <span style="color:#ff79c6">.</span>orElse<span style="color:#ff79c6">(</span>sys<span style="color:#ff79c6">.</span>env<span style="color:#ff79c6">.</span>get<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;BUILD_ENV&#34;</span><span style="color:#ff79c6">))</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>    <span style="color:#ff79c6">.</span>flatMap <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>     <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;prod&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#50fa7b">Some</span><span style="color:#ff79c6">(</span><span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Production</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>     <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;test&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#50fa7b">Some</span><span style="color:#ff79c6">(</span><span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Test</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>     <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;dev&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#50fa7b">Some</span><span style="color:#ff79c6">(</span><span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Development</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>     <span style="color:#ff79c6">case</span> unknown <span style="color:#ff79c6">=&gt;</span> <span style="color:#50fa7b">None</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>    <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>    <span style="color:#ff79c6">.</span>getOrElse<span style="color:#ff79c6">(</span><span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Development</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  <span style="color:#ff79c6">},</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  <span style="color:#6272a4">// message indicating in what environment you are building on
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span style="color:#6272a4"></span>  onLoadMessage <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>   <span style="color:#ff79c6">val</span> defaultMessage <span style="color:#ff79c6">=</span> onLoadMessage<span style="color:#ff79c6">.</span>value
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>   <span style="color:#ff79c6">val</span> env <span style="color:#ff79c6">=</span> buildEnv<span style="color:#ff79c6">.</span>value
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>   <span style="color:#f1fa8c">s&#34;&#34;&#34;|</span><span style="color:#f1fa8c">$defaultMessage</span><span style="color:#f1fa8c">
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span style="color:#f1fa8c">     |Running in build environment: </span><span style="color:#f1fa8c">$env</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>stripMargin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>  <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span> <span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span><span style="color:#ff79c6">}</span>
</code></pre></div><p>Any other process must read the build environment that the plugin code above returns. We are going to solve that problem in the main build.sbt file.</p>
<p>Our main <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/build.sbt">build.sbt</a> file (<strong>snapshot of code below</strong>), depending on the environment selected, we are going to copy the proper configuration file to conf/application.conf configuration file <strong>@see line 9 in code below, <a href="#build-code-1.1">code 1.1</a></strong>, pay attention that <strong>buildEnv.value</strong> in line 4 is created/loaded in our customized sbt plugin <a href="#buildenvplugin-code-1.0">code 1.0</a></p>
<h3 id="build-code-11">build code 1.1</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">.............</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>mappings in <span style="color:#50fa7b">Universal</span> <span style="color:#ff79c6">+=</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span> <span style="color:#ff79c6">val</span> confFile <span style="color:#ff79c6">=</span> buildEnv<span style="color:#ff79c6">.</span>value <span style="color:#ff79c6">match</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Development</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;development.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Test</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;test.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Production</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;production.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span> <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span> <span style="color:#ff79c6">((</span>resourceDirectory in <span style="color:#50fa7b">Compile</span><span style="color:#ff79c6">).</span>value <span style="color:#ff79c6">/</span> confFile<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">-&gt;</span> <span style="color:#f1fa8c">&#34;conf/application.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#ff79c6">.............</span>
</code></pre></div><p>First, we select the environment, copy all suitable config files, and then add this code to a task. We can pass parameters to our process
at this point, indicating what environment we want to build. We have coded a plugin that can read parameters. <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/CommandScalaPlay.scala">CommandScalaPlay.scala</a> will let us execute in one line reload + clean + compile + <strong>tgz distribution of our project.</strong></p>
<h3 id="commandscalaplay-code-12">commandscalaplay code 1.2</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> sbt._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">CommandScalaPlay</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#6272a4">/** https://www.scala-sbt.org/sbt-native-packager/gettingstarted.html#native-tools */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span> <span style="color:#6272a4">// A simple, multiple-argument command that prints &#34;Hi&#34; followed by the arguments.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#6272a4"></span> <span style="color:#6272a4">// Again, it leaves the current state unchanged.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#6272a4"></span> <span style="color:#6272a4">// launching from the console a production building: sbt -Denv=prod buildAll
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4"></span> <span style="color:#ff79c6">def</span> buildAll <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Command</span><span style="color:#ff79c6">.</span>args<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;buildAll&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;&lt;name&gt;&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span> <span style="color:#ff79c6">(</span>state<span style="color:#ff79c6">,</span> args<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  println<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;buildAll command generating tgz in Universal&#34;</span> <span style="color:#ff79c6">+</span> args<span style="color:#ff79c6">.</span>mkString<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34; &#34;</span><span style="color:#ff79c6">))</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#f1fa8c">&#34;reload&#34;</span><span style="color:#ff79c6">:</span><span style="color:#8be9fd">:</span>&#34;<span style="color:#8be9fd">clean</span>&#34;<span style="color:#8be9fd">::</span>&#34;<span style="color:#8be9fd">compile</span>&#34;<span style="color:#8be9fd">::</span>&#34;<span style="color:#8be9fd">universal:packageZipTarball</span>&#34;<span style="color:#8be9fd">::</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  state
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span> <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#ff79c6">}</span>
</code></pre></div><p>In the above code, we have created a command that reloads + clean + compile + <strong>tgz distribution of our project</strong> in line 11. You can glance over <a href="https://sbt-native-packager.readthedocs.io/en/latest/formats/universal.html#build">sbt-native-packager output format in universal</a> if you are interested in other output formats different than tgz.</p>
<p>We need to add the command created above in <a href="#comonsettings-code-1.3">code 1.3.</a> in our <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/build.sbt">build.sbt</a> main file. So in code below <strong>we add the command @see line 11 in code below, <a href="#comonsettings-code-1.3">code 1.3.</a></strong></p>
<h3 id="comonsettings-code-13">comonsettings code 1.3</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">.....</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">lazy</span> <span style="color:#ff79c6">val</span> commonSettings <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  name<span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;&#34;sport-stats&#34;&#34;&#34;</span><span style="color:#ff79c6">,</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  organization <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;com.mojitoverdeintw&#34;</span><span style="color:#ff79c6">,</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  version <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;1.0&#34;</span><span style="color:#ff79c6">,</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  scalaVersion <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2.11.7&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span> <span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#ff79c6">................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>settings<span style="color:#ff79c6">(</span>commonSettings<span style="color:#ff79c6">,</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  resourceDirectory in <span style="color:#50fa7b">Compile</span> <span style="color:#ff79c6">:</span><span style="color:#ff79c6">=</span> baseDirectory<span style="color:#ff79c6">.</span>value <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;conf&#34;</span><span style="color:#ff79c6">,</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  commands <span style="color:#ff79c6">++=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>buildAll<span style="color:#ff79c6">))</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#ff79c6">................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
</code></pre></div><p>In the code above, we say to the compiler that our resource directory will be /conf <strong>@see line 12 in code above, <a href="#comonsettings-code-1.3">code 1.3.</a></strong>. It should not be necessary because the resource directory( resourceDirectory in sbt) in Scala apps sbt resourceDirectory points to <strong>src/main/resources</strong>, but in play framework, the resource directory should point to <strong>/conf</strong>.</p>
<p>If you want to create a specific distribution:</p>
<p>go to your HOME_PROJECT and then:</p>
<ol>
<li>a tgz for production env <strong>sbt -Denv=prod buildAll</strong></li>
<li>a tgz for development env <strong>sbt -Denv=dev buildAll</strong></li>
<li>a universal for development env <strong>sbt -Denv=dev stage</strong></li>
<li>a universal for production env <strong>sbt -Denv=dev stage</strong></li>
</ol>
<p>If you want to implement the <strong>above scenario</strong> in your project, you need to take a look at the following points:</p>
<ol>
<li>sbt version: in the above scenario is 0.13.11, reference file: <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/build.properties">build.properties</a> in my github repository.</li>
<li><a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/plugins.sbt">plugins.sbt</a>(in my github repository): pay attention to this line: <strong>addSbtPlugin(&ldquo;com.typesafe.sbt&rdquo; % &ldquo;sbt-native-packager&rdquo; % &ldquo;1.3.2&rdquo;)</strong> in my github repository.</li>
<li><a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/build.sbt">build.sbt</a>(in my github repository): Pay attention to this file, mainly about <a href="#build-code-1.1">code 1.1</a> and [code 1.4][#buildenvplugin-code-1.4] below in this post.</li>
</ol>
<p>The picture below shows us where are the files that we mention previously(<a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/CommandScalaPlay.scala">CommandScalaPlay.scala</a>, <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/BuildEnvPlugin.scala">BuildEnvPlugin.scala</a>, <a href="https://raw.githubusercontent.com/ldipotetjob/restfulinplay/master/project/plugins.sbt">plugins.sbt</a>)</p>
<p><img src="/mojitoverde/images/tree_pluginbuildenv.png#floatcenter" alt="tree_pluginbuildenv_img"></p>
<p><strong>Remember that in our configuration folder(in playframework)</strong> <a href="https://github.com/ldipotetjob/restfulinplay/tree/master/conf">/conf</a> <strong>should be all configuration files that we want in different environments during the distro generation process, so at the end, one of those files will be our application.conf configuration file.</strong></p>
<p>In another scenario <strong>instead of creating the application.conf file in our main build.sbt file, I reckon that should be done in code because build.sbt should be as clean as possible</strong>.</p>
<p><img src="/mojitoverde/images/tree-configfile.png#floatcenter" alt="tree-configfile_img"></p>
<h3 id="buildenvplugin-code-14">buildenvplugin code 1.4</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> sbt._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">import</span> sbt.Keys._
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">import</span> sbt.plugins.JvmPlugin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#6272a4">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#6272a4"> * make calls in this way to generate development distro
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#6272a4"> * sbt -Denv=dev reload clean compile stage
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#6272a4"> *
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4"> * make calls in this way to generate production distro
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#6272a4"> * sbt -Denv=prod reload clean compile stage
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#6272a4"> *
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4"> */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4">/** sets the build environment */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BuildEnvPlugin</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">AutoPlugin</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span> <span style="color:#ff79c6">............................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span> <span style="color:#ff79c6">lazy</span> <span style="color:#ff79c6">val</span> configfilegeneratorTask <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">Def</span><span style="color:#ff79c6">.</span>task <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>  <span style="color:#ff79c6">val</span> confFile <span style="color:#ff79c6">=</span> buildEnv<span style="color:#ff79c6">.</span>value <span style="color:#ff79c6">match</span> <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>   <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Development</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;development.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>   <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Test</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;test.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>   <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Stage</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;stage.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>   <span style="color:#ff79c6">case</span> <span style="color:#50fa7b">BuildEnv</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Production</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#f1fa8c">&#34;production.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  <span style="color:#ff79c6">val</span> filesrc <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>resourceDirectory in <span style="color:#50fa7b">Compile</span><span style="color:#ff79c6">).</span>value <span style="color:#ff79c6">/</span> confFile
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  <span style="color:#ff79c6">val</span> file <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>resourceManaged in <span style="color:#50fa7b">Compile</span><span style="color:#ff79c6">).</span>value <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;application.conf&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  <span style="color:#50fa7b">IO</span><span style="color:#ff79c6">.</span>copyFile<span style="color:#ff79c6">(</span>filesrc<span style="color:#ff79c6">,</span>file<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>  <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>file<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span> <span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span style="color:#ff79c6">.....................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span style="color:#ff79c6">}</span>
</code></pre></div><p>Pay special attention to the task definition <strong>configfilegeneratorTask in line 19</strong> above [code 1.4][#buildenvplugin-code-1.4] in <a href="https://raw.githubusercontent.com/ldipotetjob/akka-quickstart-scala/master/build.sbt">BuildEnvPlugin.scala</a>(in my github repository) and then modify the build.sbt file. See the code below and the changes done in our main <a href="https://raw.githubusercontent.com/ldipotetjob/akka-quickstart-scala/master/build.sbt">build.sbt</a>(in my github repository).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">...................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">lazy</span> <span style="color:#ff79c6">val</span> root <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>project in file<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;.&#34;</span><span style="color:#ff79c6">)).</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span> aggregate<span style="color:#ff79c6">(</span>internetOfThings<span style="color:#ff79c6">).</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span> aggregate<span style="color:#ff79c6">(</span><span style="color:#50fa7b">AkkaSchedulerPoc</span><span style="color:#ff79c6">).</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span> settings<span style="color:#ff79c6">(</span>commonSettings<span style="color:#ff79c6">,</span>commands <span style="color:#ff79c6">++=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>buildAll<span style="color:#ff79c6">))</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#ff79c6">lazy</span> <span style="color:#ff79c6">val</span> <span style="color:#50fa7b">AkkaSchedulerPoc</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>project in file<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;modules/AkkaScheduler&#34;</span><span style="color:#ff79c6">)).</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span> settings<span style="color:#ff79c6">(</span>commonSettings<span style="color:#ff79c6">,</span>libraryDependencies <span style="color:#ff79c6">++=</span> <span style="color:#50fa7b">Seq</span><span style="color:#ff79c6">(</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#f1fa8c">&#34;com.enragedginger&#34;</span> <span style="color:#ff79c6">%%</span> <span style="color:#f1fa8c">&#34;akka-quartz-scheduler&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#34;1.6.1-akka-2.5.x&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span> <span style="color:#ff79c6">),</span>resourceGenerators in <span style="color:#50fa7b">Compile</span> <span style="color:#ff79c6">+=</span> configfilegenerator<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#ff79c6">...................</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
</code></pre></div><p>About the previous code <strong>line 11</strong>, we add our task <strong>configfilegenerator</strong> in our sbt compilation process. You can have a look at these files: <a href="https://raw.githubusercontent.com/ldipotetjob/akka-quickstart-scala/master/project/build.properties">build.properties</a>, <a href="https://raw.githubusercontent.com/ldipotetjob/akka-quickstart-scala/master/project/plugins.sbt">plugins.sbt</a>, <a href="https://raw.githubusercontent.com/ldipotetjob/akka-quickstart-scala/master/build.sbt">build.sbt</a></p>
<p><strong>Remember that the plugin and task should be under the root project folder. (fig 1.1 above in our post)</strong></p>
<p><strong>Remember that in our configuration folder (in akka)</strong> <a href="https://github.com/ldipotetjob/akka-quickstart-scala/tree/master/modules/AkkaScheduler/src/main/resources">/resource</a> folder <a href="https://github.com/ldipotetjob/restfulinplay/tree/master/conf">/conf</a> <strong>should be all configuration files that we want in different environments during the distro creation process so at the end one of those files will be our application.conf configuration file.</strong></p>
<p><img src="/mojitoverde/images/tree_akkaconf.png#floatcenter" alt="tree_akkaconf_img"></p>
<p>When you are working with autoplugin, when you create a task or other object that executes any processes in a specific phase <strong>you could face some problems with the initialization process</strong> because some settings are loaded twice. So the <a href="https://www.scala-sbt.org/1.x/docs/Setting-Initialization.html">sbt initialization</a> can be a fruitful reading.</p>
<p>There are different ways to generate distributions in several environments. Sbt has many other solutions, <strong>but in my opinion, they are specific to each file and not for a complete configuration</strong> like (log specification file + application configuration file + other properties or metadata file that can change when we change environment)</p>
<p>We show you examples in Playframework and Akka but how to solve if you want to generate any implementation or distribution without any plugins so you can choose the options that SBT gives you:</p>
<p>sbt <strong>-Dconfig.file</strong>=<!-- raw HTML omitted -->/my-environment-conf-file.conf other-phases</p>
<p>An example of the previous statement:</p>
<p><strong>sbt -Dconfig.file=/home/myusr/development.conf reload clean compile stage</strong></p>
<p>You can use <strong>-Dconfig.resource</strong> in the same way no need to specify the path to the file in this case. Sbt will try to find out in the resource directory.</p>
<p>You can do the same with <strong>logging configuration</strong> so in the same way:</p>
<p>sbt <strong>-Dlogger.file</strong> <!-- raw HTML omitted -->/my-environment-logger-conf-file.conf</p>
<p><strong>or</strong> like config.resource you can use <strong>-Dlogger.resource</strong>. You do not  need to specify the path to the log configuration file because the file is loaded from the classpath in this case</p>
<p>There are some interesting links in Sbt explaining how to deal with the distro generation process in different environments :</p>
<ol>
<li><a href="https://www.playframework.com/documentation/2.6.x/ProductionConfiguration#Specifying-an-alternate-configuration-file">Specifying different configurations files</a>.</li>
<li><a href="https://www.playframework.com/documentation/2.6.x/ProductionConfiguration#Logging-configuration">Specifying different logging configurations files</a>.</li>
</ol>
<p>Keep in mind:
To pay attention to <a href="https://github.com/lightbend/config/blob/master/HOCON.md">HOCON</a>(Human-Optimized Config Object Notation) and how it works. It can be helpful to proccess configuration files.</p>

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/mojitoverde/">Home</a></li>
         
          <li><a href="/mojitoverde/posts">Blog</a></li>
         
          <li><a href="/mojitoverde/tags">Tags</a></li>
         
          <li><a href="/mojitoverde/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-do-we-need">What do we need:</a></li>
        <li><a href="#buildenvplugin-code-10">buildenvplugin code 1.0</a></li>
        <li><a href="#build-code-11">build code 1.1</a></li>
        <li><a href="#commandscalaplay-code-12">commandscalaplay code 1.2</a></li>
        <li><a href="#comonsettings-code-13">comonsettings code 1.3</a></li>
        <li><a href="#buildenvplugin-code-14">buildenvplugin code 1.4</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&text=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&is_video=false&description=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments&body=Check out this article: https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&title=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&name=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments&description=From%20my%20perspective%2c%20Sbt%20is%20quite%20complex.%20I%20need%20to%20work%20with%20the%20sbt%20documentation%20at%20hand.%20Many%20people%20think%20that%20SBT%20is%20confusing%2c%20complicated%2c%20and%20opaque.%20My%20goal%20today%3a%20%2a%2ahow%20to%20generate%20distribution%20packages%20for%20different%20environments%20%2a%2a%20just%20in%20one%20command%20line%20clean%20%2b%20compile%20%2b%20build%20distribution%20%2b%20specific%20environment.%0aWhat%20do%20we%20need%3a%20%20Pass%20parameters%20to%20our%20process%20indicating%20what%20environment%20you%20want%20to%20build.%20Create%20a%20plugin%20to%20read%20the%20parameters." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fldipotetjob.github.io%2fmojitoverde%2fposts%2f2019-02-12-generatedistroplayscala%2f&t=Generating%20scala%20application%20distribution%20in%20akka%20%26%20play%20for%20different%20environments" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  Scadip 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/mojitoverde/">Home</a></li>
         
        <li><a href="/mojitoverde/posts">Blog</a></li>
         
        <li><a href="/mojitoverde/tags">Tags</a></li>
         
        <li><a href="/mojitoverde/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/mojitoverde/lib/font-awesome/css/all.min.css>
<script src=/mojitoverde/lib/jquery/jquery.min.js></script>
<script src=/mojitoverde/js/main.js></script>
<script src=/mojitoverde/js/code-copy.js></script>



</html>
